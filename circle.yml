
dependencies:
  pre: 
   - sudo service docker start; sudo service docker status; sudo docker -v; sudo docker info;
   
  post:
   - mkdir jenkins_home/plugins; wget -P jenkins_home/plugins http://updates.jenkins-ci.org/latest/logstash.hpi
   - sudo docker build -t="jenkinselastic" .
   - sudo docker run -d --name jenkinselastic -p 8080:8080 jenkinselastic
   - sudo docker save -o $CIRCLE_ARTIFACTS/jenkinsElasticDocker.tar jenkinselastic
   - ./install.sh
   - sudo docker save -o $CIRCLE_ARTIFACTS/elasticsearch.tar elasticsearch
   - sudo docker save -o $CIRCLE_ARTIFACTS/kibana.tar kibana

deployment:
  dockerhub:
    branch: master
    commands:
      - $DOCKER_HUB_TRIGGER
      
test:
  override:
  - docker ps | grep jenkinselastic && docker ps | grep elasticsearch && docker ps | grep kibana
  